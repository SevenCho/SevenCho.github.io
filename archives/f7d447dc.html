<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">






  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-flash.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.1" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.1">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.1" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.4.1',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="多少年后当眼前的一切成为结局，时间改变了我，改变了村里的一切。整个老掉的一代人，坐在黄昏里感叹岁月流逝、沧桑巨变。没人知道有些东西是被我改变的。在时间经过这个小村庄的时候，我帮了时间的忙，让该变的一切都有了变迁。我老的时候，我会说：我是在时光中老的。 ——刘亮程《一个人的村庄》">
<meta name="keywords" content="Swift,服务器,Perfect">
<meta property="og:type" content="article">
<meta property="og:title" content="Swift开发服务端（三）：Perfect再次初体验">
<meta property="og:url" content="https://sevencho.github.io/archives/f7d447dc.html">
<meta property="og:site_name" content="曹雪松de博客|CoderBoy&#39;s Blog">
<meta property="og:description" content="多少年后当眼前的一切成为结局，时间改变了我，改变了村里的一切。整个老掉的一代人，坐在黄昏里感叹岁月流逝、沧桑巨变。没人知道有些东西是被我改变的。在时间经过这个小村庄的时候，我帮了时间的忙，让该变的一切都有了变迁。我老的时候，我会说：我是在时光中老的。 ——刘亮程《一个人的村庄》">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://sevencho.github.io/uploads/assets/perfect_touchBar.jpg">
<meta property="og:image" content="https://sevencho.github.io/uploads/assets/perfect_touchBar2.jpg">
<meta property="og:image" content="https://sevencho.github.io/uploads/assets/perfectAssistant_download.png">
<meta property="og:image" content="https://sevencho.github.io/uploads/assets/perfectAssistant_interface.png">
<meta property="og:image" content="https://sevencho.github.io/uploads/assets/perfectAssistant_newProject.png">
<meta property="og:image" content="https://sevencho.github.io/uploads/assets/perfectAssistant_clone.png">
<meta property="og:image" content="https://sevencho.github.io/uploads/assets/perfectAssistant_dependencies.png">
<meta property="og:image" content="https://sevencho.github.io/uploads/assets/perfectAssistant_Project_build.png">
<meta property="og:image" content="https://sevencho.github.io/uploads/assets/perfect_server_init.png">
<meta property="og:image" content="https://sevencho.github.io/uploads/assets/perfect_server_generate.png">
<meta property="og:image" content="https://sevencho.github.io/uploads/assets/MySQL_connect.png">
<meta property="og:image" content="https://sevencho.github.io/uploads/assets/mysql_t-user.png">
<meta property="og:image" content="https://sevencho.github.io/uploads/assets/mysql_t-note.png">
<meta property="og:image" content="https://sevencho.github.io/uploads/assets/server_register_test.png">
<meta property="og:updated_time" content="2018-09-03T03:35:54.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Swift开发服务端（三）：Perfect再次初体验">
<meta name="twitter:description" content="多少年后当眼前的一切成为结局，时间改变了我，改变了村里的一切。整个老掉的一代人，坐在黄昏里感叹岁月流逝、沧桑巨变。没人知道有些东西是被我改变的。在时间经过这个小村庄的时候，我帮了时间的忙，让该变的一切都有了变迁。我老的时候，我会说：我是在时光中老的。 ——刘亮程《一个人的村庄》">
<meta name="twitter:image" content="https://sevencho.github.io/uploads/assets/perfect_touchBar.jpg">



  <link rel="alternate" href="/atom.xml" title="曹雪松de博客|CoderBoy's Blog" type="application/atom+xml" />




  <link rel="canonical" href="https://sevencho.github.io/archives/f7d447dc.html"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Swift开发服务端（三）：Perfect再次初体验 | 曹雪松de博客|CoderBoy's Blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">曹雪松de博客|CoderBoy's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">技术宅 iOS开发 美剧控</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives menu-item-active">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-commonweal">
    <a href="/404.html" rel="section">
      <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />公益</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-categories" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://sevencho.github.io/archives/f7d447dc.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="曹雪松">
      <meta itemprop="description" content="一只特立独行的CoderBoy🐶">
      <meta itemprop="image" content="/uploads/images/avatar.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="曹雪松de博客|CoderBoy's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Swift开发服务端（三）：Perfect再次初体验
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-08-24 15:25:25" itemprop="dateCreated datePublished" datetime="2018-08-24T15:25:25+08:00">2018-08-24</time>
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/服务器/" itemprop="url" rel="index"><span itemprop="name">服务器</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">17k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">31 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <hr>
<blockquote>
<p>多少年后当眼前的一切成为结局，时间改变了我，改变了村里的一切。整个老掉的一代人，坐在黄昏里感叹岁月流逝、沧桑巨变。没人知道有些东西是被我改变的。在时间经过这个小村庄的时候，我帮了时间的忙，让该变的一切都有了变迁。我老的时候，我会说：我是在时光中老的。</p>
<p>——刘亮程《一个人的村庄》</p>
</blockquote>
<a id="more"></a>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ul>
<li>Perfect是一组完整、强大的工具箱、软件框架体系和Web应用服务器，可以在<code>Linux</code>和<code>macOS</code> (OS X)上使用。该软件体系为<code>Swift工程师</code>量身定制了一整套用于开发轻量、易维护、规模可扩展的<code>Web应用</code>及其它<code>REST服务</code>的解决方案，这样Swift工程师就可以实现同时在服务器和客户端上采用同一种语言开发软件项目。</li>
<li><p>由于建立在一个高性能异步网络引擎基础上，Perfect还能够在<code>FastCGI</code>上运行，支持安全套接字加密（<code>SSL</code>）。该软件体系还包含很多其它互联网服务器所需要的特点，包括<code>WebSockets</code>和<code>iOS消息推送</code>，而且很快会有更多强大的功能支持。</p>
</li>
<li><p><a href="https://sevencho.github.io/archives/6efe8aae.html">Swift开发服务端（一）：MySQL安装及配置</a></p>
</li>
<li><a href="https://sevencho.github.io/archives/64bb63f1.html">Swift开发服务端（二）：使用Parallels Desktop虚拟机安装Ubuntu系统及相关配置</a></li>
</ul>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><ul>
<li>有很多小伙伴肯定在想，我为什么会把第一次给了<code>Perfect</code>🌝，那是因为<code>Perfect</code>有官方中文文档，虽然不是非常完善的中文文档，但有胜于无，减少了入门的难度。</li>
<li>什么，为什么叫再次初体验。那是因为上次的初体验不算。为什么不算、因为我说的🌚🌚。</li>
<li>本篇完全基于Mac系统，为什么不基于上一篇安装的<code>Ubuntu</code>系统呢，因为相较于Mac，在<code>Ubuntu</code>下只是多了Swift安装环境配置和其他需要的服务安装，都特别简单，更重要的是我们需要使用到Xcode进行编码、编译。</li>
<li><a href="https://www.perfect.org/docs/index_zh_CN.html" target="_blank" rel="noopener">Perfect官方文档在这里</a></li>
</ul>
<h2 id="Ubuntu安装Swift"><a href="#Ubuntu安装Swift" class="headerlink" title="Ubuntu安装Swift"></a>Ubuntu安装Swift</h2><ul>
<li>关于在Ubuntu系统下载安装Swift，参考<a href="https://swift.org/download/#using-downloads" target="_blank" rel="noopener">Swift官方文档</a>，已经介绍的非常详细了。</li>
<li>如果你不想看英文官方文档，好吧，那我就再总结（复制）一下：</li>
</ul>
<h3 id="安装Git"><a href="#安装Git" class="headerlink" title="安装Git"></a>安装Git</h3><ul>
<li>首先检查系统有没有安装Git，如果没有安装，直接使用包管理器安装：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git</span><br></pre></td></tr></table></figure>
<h3 id="安装Swift依赖组件"><a href="#安装Swift依赖组件" class="headerlink" title="安装Swift依赖组件"></a>安装Swift依赖组件</h3><ul>
<li>确保您的系统上的包管理器是最新的：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>
<ul>
<li>安装<code>Swift</code>必要的依赖组件，如<code>clang</code>和<code>Python</code>等。<ul>
<li><code>openssh-server</code> 我们在安装Ubuntu一章中已经安装过，所以不用重复安装了。</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install clang libicu-dev libpython2.7</span><br></pre></td></tr></table></figure>
<h3 id="安装Swift"><a href="#安装Swift" class="headerlink" title="安装Swift"></a>安装Swift</h3><ul>
<li>下载最新的<code>Swift二进制</code>文件，可以手动下载，也可以使用<code>wget</code>下载。<ul>
<li>根据自己的Ubuntu系统版本和需要的swift版本选择，在<a href="https://swift.org/download/#releases" target="_blank" rel="noopener">这里下载</a>。</li>
<li><code>.tar.gz</code>后缀的是工具链二进制文件 <code>.sig</code> 后缀的是数字签名文件。</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://swift.org/builds/swift-4.0-release/ubuntu1604/swift-4.0-RELEASE/swift-4.0-RELEASE-ubuntu16.04.tar.gz</span><br></pre></td></tr></table></figure>
<ul>
<li>如果你是<code>第一次</code>下载安装Swift包，需要将Swift的PGP密钥导入您的密钥环，密钥将用于验证下载的文件有无被被损坏或篡改。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gpg --keyserver hkp://pool.sks-keyservers.net \</span><br><span class="line">      --recv-keys \</span><br><span class="line">      '7463 A81A 4B2E EA1B 551F  FBCF D441 C977 412B 37AD' \</span><br><span class="line">      '1BE1 E29A 084C B305 F397  D62A 9F59 7F4D 21A5 6D5F' \</span><br><span class="line">      'A3BA FD35 56A5 9079 C068  94BD 63BC 1CFE 91D3 06C6' \</span><br><span class="line">      '5E4D F843 FB06 5D7F 7E24  FBA2 EF54 30F0 71E1 B235'</span><br></pre></td></tr></table></figure>
<ul>
<li>导入密钥之后，下载对应Swift版本的签名文件：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://swift.org/builds/swift-4.0-release/ubuntu1604/swift-4.0-RELEASE/swift-4.0-RELEASE-ubuntu16.04.tar.gz.sig</span><br></pre></td></tr></table></figure>
<ul>
<li>验证签名文件：<ul>
<li>如果出现警告信息，可忽略；如果出现错误信息，就需要重新下载Swift二进制文件。</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg --verify swift-4.0-RELEASE-ubuntu16.04.tar.gz.sig</span><br></pre></td></tr></table></figure>
<ul>
<li>安装完成密钥和签名文件，现在就可以安装Swift。 执行以下命令来提取之前下载的二进制文件：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar xzf swift-4.0-RELEASE-ubuntu16.04.tar.gz</span><br></pre></td></tr></table></figure>
<ul>
<li>将Swift工具链添加到环境变量中，以便运行swift命令：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=swift-4.0-RELEASE-ubuntu16.04/usr/bin:"$&#123;PATH&#125;"</span><br></pre></td></tr></table></figure>
<ul>
<li>这个命令只会将swift命令添加到<code>当前shell会话</code>路径中，如果要确保它在以后的会话中自动添加，要将其添加到<code>.bashrc</code>文件中。<ul>
<li>打开 <code>.bashrc</code> 文件</li>
<li>文件尾部添加环境变量</li>
<li>保存退出</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi ~/.bashrc // 也可以使用nano</span><br><span class="line">export PATH=swift-4.0-RELEASE-ubuntu16.04/usr/bin:"$&#123;PATH&#125;"</span><br></pre></td></tr></table></figure>
<ul>
<li>在终端输入<code>swift</code>，如果输出<code>Welcome to Apple Swift version xxx</code>则表示安装swift成功。</li>
</ul>
<h2 id="Perfect服务端"><a href="#Perfect服务端" class="headerlink" title="Perfect服务端"></a>Perfect服务端</h2><h3 id="使用工具新建Perfect项目"><a href="#使用工具新建Perfect项目" class="headerlink" title="使用工具新建Perfect项目"></a>使用工具新建Perfect项目</h3><ul>
<li>想体验一个新技术，最简便的方法莫过于GUI工具，简单的点几下就可以运行起来。</li>
<li><code>Perfect Assistant</code>专门用于服务器端Swift应用的启动、管理、编译、测试和部署，极大简化了上述工作的操作过程。无论是初次接触服务器的Swift程序员还是企业级的服务器Swift高级工程师，相信都可以从中受益。</li>
<li>使用<code>Perfect</code>搭建服务端之所以比较强大的原因之一：提供了可视化的工具帮助快速入门体验一个服务端软件的搭建。</li>
<li>而且她不仅支持自家的<code>Perfect</code>库，还支持另一个Swift服务端开发库<code>Vapor</code>。</li>
<li>更更更加支持新款MBP的<code>Touch Bar</code>，，恩，我的还是不支持<code>Touch Bar</code>的15款的MBP🌚。</li>
</ul>
<center><img src="/uploads/assets/perfect_touchBar.jpg" alt="perfect_touchBar"></center><br><center><img src="/uploads/assets/perfect_touchBar2.jpg" alt="perfect_touchBar2"></center>

<h4 id="Perfect-Assistant-功能"><a href="#Perfect-Assistant-功能" class="headerlink" title="Perfect Assistant 功能"></a>Perfect Assistant 功能</h4><ul>
<li>新建Swift服务器工程，或者从现有项目模板中新建工程</li>
<li>管理组件依存关系</li>
<li>同步交叉编译——即在您的mac计算机上同步编译同一个服务器应用在macOS和Ubuntu操作系统上的二进制程序</li>
<li>配置亚马逊弹性计算或者谷歌云应用</li>
<li>将项目部署为亚马逊EC2弹性云计算服务器例程，或者谷歌云应用引擎服务器例程</li>
</ul>
<h4 id="下载Perfect-Assistant"><a href="#下载Perfect-Assistant" class="headerlink" title="下载Perfect Assistant"></a>下载Perfect Assistant</h4><ul>
<li>官方下载地址在<a href="https://www.perfect.org/en/perfect-assistant.html" target="_blank" rel="noopener">这里</a></li>
<li>点击下载、安装即可。（注意需要科学上网，否则可能很慢）</li>
</ul>
<center><img src="/uploads/assets/perfectAssistant_download.png" alt="perfectAssistant_download"></center>

<ul>
<li>安装完成后打开界面如下：</li>
</ul>
<center><img src="/uploads/assets/perfectAssistant_interface.png" alt="perfectAssistant_interface"></center>

<ul>
<li>关于<code>docker</code><ul>
<li><code>Perfect Assistant</code>是支持使用<code>docker</code>进行编译和部署到Linux上的，安装<code>docker</code>后就可以在本地对代码进行linux环境的编译后直接部署到linux服务器上。 </li>
<li><code>更重要的是</code>：使用<code>docker</code>可以打包应用以及依赖包到一个<code>可移植的容器</code>中，然后发布到<code>任何</code>流行的Linux机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口。以后需要其他linux上部署，只需要将制作好的<code>docker镜像</code>拉取下来就可以运行，不需要再配置环境和依赖。</li>
<li>安装docker大概需要15G左右的磁盘空间，我因为系统盘磁盘空间有限，就没有安装。之前试了下安装大概需要几分钟时间（前提网速够快）。 需要安装的小伙伴，直接点击如图所示的 <code>立即安装docker</code>、等待安装完成即可。</li>
<li>关于想了解更多docker知识的，官网在<a href="https://www.docker.com/" target="_blank" rel="noopener">这里</a>。</li>
</ul>
</li>
</ul>
<h4 id="使用Perfect-Assistant创建项目"><a href="#使用Perfect-Assistant创建项目" class="headerlink" title="使用Perfect Assistant创建项目"></a>使用Perfect Assistant创建项目</h4><ul>
<li>安装好<code>Perfect Assistant</code>后，快速创建一个服务端应用，只需要点击创建项目窗口的<code>Perfect模板App</code>：</li>
</ul>
<center><img src="/uploads/assets/perfectAssistant_newProject.png" alt="perfectAssistant_newProject"></center>

<ul>
<li>选择项目需要放置的文件目录及项目名称（我这里还是以最早体验服务端项目的名字命名）。</li>
<li>红框选项可选可不选，勾选后在Xcode编译项目的时候会，会运行及反馈一些linux环境的编译信息，后面需要的时候可以再重新勾选，现在的电脑配置其实勾选了也并不会增加太长的编译时间。</li>
</ul>
<h4 id="配置处理项目依赖"><a href="#配置处理项目依赖" class="headerlink" title="配置处理项目依赖"></a>配置处理项目依赖</h4><ul>
<li>项目依赖都是通过<code>Swift的包管理器</code>处理的，Swift包依赖管理请参考<a href="https://swift.org/package-manager/#conceptual-overview" target="_blank" rel="noopener">官方文档</a>.</li>
<li>创建项目完成会默认先拉取模板应用的相关依赖，在默认应用中默认已经配置过HTTPServer依赖了，处理窗口如下：</li>
</ul>
<center><img src="/uploads/assets/perfectAssistant_clone.png" alt="perfectAssistant_clone"></center>

<ul>
<li><p>后期需要添加自己的依赖库时候，如数据库、打印等等，只需要在下面的<code>可用依赖</code>窗口中选择需要依赖直接拖拽到上面<code>项目依赖</code>窗口即可。</p>
<center><img src="/uploads/assets/perfectAssistant_dependencies.png" alt="perfectAssistant_dependencies"></center>
</li>
<li><p>如果在<code>可用依赖</code>窗口没有找到我们需要的，也可以点<code>项目依赖</code>窗口右边的<code>+</code>号按钮，添加自定义的项目依赖：其实就是添加依赖的<code>Package Manager</code>地址及功能类别。</p>
</li>
<li><p>更多<code>Perfect Assistant</code>工具使用及功能介绍，请参考<a href="https://www.perfect.org/zh/assistant/" target="_blank" rel="noopener">官方文档</a>。</p>
</li>
</ul>
<h4 id="编译运行项目"><a href="#编译运行项目" class="headerlink" title="编译运行项目"></a>编译运行项目</h4><ul>
<li>项目依赖处理完成，就可以找到我们创建的项目目录下的<code>iNoteServer.xcodeproj</code>文件，具体名称请参考你创建项目的名称，通过<code>Xcode</code>打开。</li>
<li>注意，在项目Scheme中选择可执行文件，默认选中的的是<code>项目名称-Package</code>。</li>
</ul>
<center><img src="/uploads/assets/perfectAssistant_Project_build.png" alt="perfectAssistant_Project_build"></center>

<ul>
<li>然后直接编译运行，就可以看到控制台输出：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[INFO] Starting HTTP server localhost on 0.0.0.0:8181</span><br></pre></td></tr></table></figure>
<ul>
<li>此时就已经开了一个本地端口<code>8181</code>的服务，直接在浏览器输入上述地址及端口，就可以看到令人兴奋的<code>Hello, world!</code>了。</li>
</ul>
<h3 id="使用终端新建Perfect项目"><a href="#使用终端新建Perfect项目" class="headerlink" title="使用终端新建Perfect项目"></a>使用终端新建Perfect项目</h3><ul>
<li>使用终端命令创建项目也不是很复杂，重要的是可以自己把控项目创建的细节，创建出来的项目更加的干净，我比较喜欢使用终端创建项目。</li>
</ul>
<h4 id="使用终端新建项目"><a href="#使用终端新建项目" class="headerlink" title="使用终端新建项目"></a>使用终端新建项目</h4><ul>
<li>创建一个存放项目的文件夹<code>iNote</code>，后续服务端对应的客户端项目<code>iNoteClient</code>也可以放在这个文件夹内。</li>
<li>在<code>iNote</code>文件夹下创建一个存放服务端项目的文件夹<code>iNoteServer</code>。</li>
<li>将<code>iNoteServer</code>目录初始化为一个<code>Git仓库</code>。</li>
<li>创建<code>Package.swift</code>文件，该文件是用Swift包管理器（SPM）管理依赖需要的，用来管理整个项目的依赖。我们可以使用Xcode打开该文件，编辑添加需要的项目依赖。如：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import PackageDescription</span><br><span class="line"></span><br><span class="line">let versions = Version(0,0,0)..&lt;Version(10,0,0)</span><br><span class="line">let urls = [</span><br><span class="line">    "https://github.com/PerfectlySoft/Perfect-HTTPServer.git", // 最基本的服务器核心依赖</span><br><span class="line">    "https://github.com/PerfectlySoft/Perfect-MySQL.git", // MySQL服务器</span><br><span class="line">    "https://github.com/PerfectlySoft/Perfect-Logger.git", // 日志处理库</span><br><span class="line">    "https://github.com/PerfectlySoft/Perfect-RequestLogger.git" // 请求日志处理库</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">let package = Package(</span><br><span class="line">    name: "iNoteServer",</span><br><span class="line">    targets: [],</span><br><span class="line">    dependencies: urls.map &#123; .Package(url: $0, versions: versions) &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>回到终端，创建<code>Sources</code>目录，该目录用于存放我们自己写的项目源代码。</li>
<li>创建一个程序入口文件，并在空文件中插入一个打印函数：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo 'print("hello world!")' &gt;&gt; Sources/main.swift</span><br></pre></td></tr></table></figure>
<h4 id="配置处理项目依赖-1"><a href="#配置处理项目依赖-1" class="headerlink" title="配置处理项目依赖"></a>配置处理项目依赖</h4><ul>
<li>项目依赖已经配置完成，此时需要处理项目依赖并生成可执行文件：</li>
<li>处理过程会在终端输出对应的信息，时间长短取决于在<code>Package.swift</code>文件中配置的依赖库多少及每个库大小。</li>
<li>生成的可执行文件在项目的根目录的<code>debug目录</code>下。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swift build</span><br></pre></td></tr></table></figure>
<ul>
<li>默认是生成的Debug版本的可执行文件，如果是正式部署服务器的可执行文件，可使用如下指令生成发布版本可执行文件：</li>
<li>生成的可执行文件在项目的根目录的<code>release目录</code>下。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swift build -c release</span><br></pre></td></tr></table></figure>
<center><img src="/uploads/assets/perfect_server_init.png" alt="perfect_server_init"></center>

<ul>
<li>一般很快就可以处理完成，处理完成就会在终端输出信息可以看到生成了一个由项目名称命名的可执行文件，根据提示信息执行对应的可执行文件，就可以输出我们的打印信息了：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./build/debug/iNoteServer // debug模式</span><br><span class="line">./build/release/iNoteServer // release模式</span><br></pre></td></tr></table></figure>
<ul>
<li>可以使用Swift包管理器创建一个<code>xxx.xcodeproj</code>文件用于使用Xcode来管理和编辑调试项目，执行下面的指令，生成Xcode项目管理文件：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swift package generate-xcodeproj</span><br></pre></td></tr></table></figure>
<center><img src="/uploads/assets/perfect_server_generate.png" alt="perfect_server_generate"></center>

<ul>
<li>配置项目文件的搜索目录为整个项目目录：<ul>
<li><code>$(SRCROOT)</code>代表的时项目根目录下</li>
<li><code>$(PROJECT_DIR)</code>代表的是整个项目</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">(PROJECT_DIR)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>如果添加新的项目依赖库后只需要重新<code>swift build</code> 或者 <code>swift build -c release</code>等待完成即可。</li>
<li>如果添加新的依赖后出现未知错误，可尝试删除项目根目录下的<code>xxx.xcodeproj</code>文件，然后使用<code>swift package generate-xcodeproj</code>重新生成项目文件即可。</li>
</ul>
<h2 id="搭建HTTP服务器"><a href="#搭建HTTP服务器" class="headerlink" title="搭建HTTP服务器"></a>搭建HTTP服务器</h2><ul>
<li>创建iNoteAIP文件，用于管理所有的<code>路由</code>。大概分为用户及笔记两类。</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">iNoteAIP</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">case</span> base = <span class="string">"/iNote"</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// 注册页面</span></span><br><span class="line">    <span class="keyword">case</span> register = <span class="string">"/register"</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// 登录页面</span></span><br><span class="line">    <span class="keyword">case</span> login = <span class="string">"/login"</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// 获取笔记列表</span></span><br><span class="line">    <span class="keyword">case</span> notes = <span class="string">"/notes"</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// 添加笔记</span></span><br><span class="line">    <span class="keyword">case</span> creatNote = <span class="string">"/creatNote"</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// 删除笔记</span></span><br><span class="line">    <span class="keyword">case</span> removeNote = <span class="string">"/removeNote"</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// 修改笔记</span></span><br><span class="line">    <span class="keyword">case</span> editNote = <span class="string">"/editNote"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>创建一个<code>NetworkServerManager</code>文件用于服务器的相关操作，如服务器开启及停止，端口监控、路由监控及处理等等。</li>
<li>关于服务器API设计及命名，请参考<a href="https://juejin.im/post/59826a4e518825359c5e72d1" target="_blank" rel="noopener">服务端指南 | 良好的 API 设计指南</a>这一篇文章，写的很不错。</li>
<li>首先实例化一个<code>HTTPServer</code>对象，绑定指定的端口，并添加项目需要用到的路由。</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入需要的头文件</span></span><br><span class="line"><span class="keyword">import</span> PerfectHTTP</span><br><span class="line"><span class="keyword">import</span> PerfectHTTPServer</span><br><span class="line"><span class="keyword">import</span> PerfectRequestLogger</span><br><span class="line"><span class="keyword">import</span> PerfectLogger</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetworkServerManager</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> server = <span class="type">HTTPServer</span>()</span><br><span class="line">    <span class="keyword">var</span> routes = <span class="type">Routes</span>(baseUri: iNoteAIP.base.rawValue)</span><br><span class="line">    <span class="keyword">var</span> api1Routes = <span class="type">Routes</span>(baseUri: <span class="string">"/v1"</span>) <span class="comment">// 将所有的路由根据版本号进行区分管理，方便后期接口逻辑调整，新版本不会影响到旧版本</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> shared = <span class="type">NetworkServerManager</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">init</span>() &#123;</span><br><span class="line">        routesConfigure() <span class="comment">// 配置路由</span></span><br><span class="line">        loggerConfigure() <span class="comment">// 配置日志工具</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">serverStart</span><span class="params">(<span class="number">_</span> port: UInt16 = <span class="number">8181</span>)</span></span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 监听端口 绑定路由</span></span><br><span class="line">        server.serverPort = port</span><br><span class="line">        server.addRoutes(routes)</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> server.start()</span><br><span class="line">        &#125; <span class="keyword">catch</span> <span class="type">PerfectError</span>.networkError(<span class="keyword">let</span> code, <span class="keyword">let</span> message) &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"network error:\(code) \(message)"</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"unknow network error: \(error)"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>具体的项目添加的路由（以注册为例子）以及配置系统的日志工具（日志信息记录到本地文件）。</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NetworkServerManager</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">addRoute</span><span class="params">(with method: HTTPMethod, uri: iNoteAIP, handler: @escaping RequestHandler)</span></span></span><br><span class="line">    &#123;</span><br><span class="line">        api1Routes.add(method: method, uri: uri.rawValue, handler: handler)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// 配置各个模块的路由 </span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">routesConfigure</span><span class="params">()</span></span></span><br><span class="line">    &#123;</span><br><span class="line">        addRoute(with: .post, uri: .register, handler: registerHanlder())</span><br><span class="line"><span class="comment">//        addRoute(with: .post, uri: .login, handler: loginHanlder())</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        addRoute(with: .post, uri: .creatNote, handler: creatNoteHanlder())</span></span><br><span class="line"><span class="comment">//        addRoute(with: .post, uri: .editNote, handler: editNoteHanlder())</span></span><br><span class="line"><span class="comment">//        addRoute(with: .delete, uri: .removeNote, handler: removeNoteHanlder())</span></span><br><span class="line"><span class="comment">//        addRoute(with: .get, uri: .notes, handler: notesHanlder())</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 所有路由</span></span><br><span class="line">        routes.add(api1Routes)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// 添加日志文件记录</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">loggerConfigure</span><span class="params">()</span></span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 日志路径</span></span><br><span class="line">        <span class="keyword">let</span> logPath = <span class="string">"./files/logs"</span></span><br><span class="line">        <span class="keyword">if</span> !<span class="type">Dir</span>(logPath).exists &#123;</span><br><span class="line">            <span class="keyword">try</span>? <span class="type">Dir</span>(logPath).create()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">LogFile</span>.location = <span class="string">"\(logPath)/iNoteServer.log"</span>     <span class="comment">// 设置日志文件路径</span></span><br><span class="line">        <span class="comment">// 增加日志过滤器，将日志写入相应的文件</span></span><br><span class="line">        server.setRequestFilters([(<span class="type">RequestLogger</span>(), .high)])    <span class="comment">// 首先增加高优先级的过滤器</span></span><br><span class="line">        server.setResponseFilters([(<span class="type">RequestLogger</span>(), .low)])    <span class="comment">// 最后增加低优先级的过滤器</span></span><br><span class="line">        <span class="comment">// 项目中根据打印级别打印信息</span></span><br><span class="line">        <span class="comment">//LogFile.debug("调试")</span></span><br><span class="line">        <span class="comment">//LogFile.info("消息")</span></span><br><span class="line">        <span class="comment">//LogFile.warning("警告")</span></span><br><span class="line">        <span class="comment">//LogFile.error("出错")</span></span><br><span class="line">        <span class="comment">//LogFile.critical("严重错误")</span></span><br><span class="line">        <span class="comment">//LogFile.terminal("服务器终止")</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>处理路由绑定的回调，即当用户触发的对应接口会在这个地方处理，以<code>注册</code>路由绑定的回调为例子：</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MARK: 处理路由回调</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NetworkServerManager</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">registerHanlder</span><span class="params">()</span></span> -&gt; <span class="type">RequestHandler</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; request, response <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">let</span> user = <span class="type">User</span>()</span><br><span class="line">            user.userName = request.param(name: <span class="string">"userName"</span>)</span><br><span class="line">            user.password = request.param(name: <span class="string">"password"</span>)</span><br><span class="line">            <span class="keyword">let</span> resultString = <span class="type">UserMediator</span>.creat(a: user)</span><br><span class="line">            response.setBody(string: resultString)</span><br><span class="line">            response.completed()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>创建一个<code>UserMediator</code>文件作为用户逻辑的中间层，用于管理用户的相关的逻辑，如用户是否重名、参数是否合法，响应数据格式处理等等：</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">ResponseStatus</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> success = <span class="string">"Success"</span></span><br><span class="line">    <span class="keyword">case</span> failure = <span class="string">"Failure"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">ResponseErrorMessage</span>: <span class="title">String</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> parameterIncompleteness = <span class="string">"参数不完整"</span></span><br><span class="line">    <span class="keyword">case</span> userExist = <span class="string">"用户已经注册"</span></span><br><span class="line">    <span class="keyword">case</span> userCreationFailed = <span class="string">"用户注册失败"</span></span><br><span class="line">    <span class="keyword">case</span> wrongUsernameOrPassword = <span class="string">"用户名密码错误"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="type">TableName</span> = <span class="string">"T_User"</span>   <span class="comment">// 数据库中的用户表</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserMediator</span> </span>&#123;</span><br><span class="line">    <span class="comment">/// 创建成功返回对应的用户信息，不成功返回失败原因</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">creat</span><span class="params">(a user: User)</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> userName = user.userName,</span><br><span class="line">            <span class="keyword">let</span> password = user.password,</span><br><span class="line">            userName.<span class="built_in">count</span> &gt; <span class="number">0</span>,</span><br><span class="line">            password.<span class="built_in">count</span> &gt; <span class="number">0</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>.handle(with: .failure, isSuccess: <span class="literal">false</span>, message: <span class="type">ResponseErrorMessage</span>.parameterIncompleteness.rawValue, value: [])</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 用户是否存在</span></span><br><span class="line">        <span class="keyword">let</span> isExist = <span class="type">DataBaseManager</span>.shared.isExist(of: userName, <span class="keyword">in</span>: <span class="type">TableName</span>)</span><br><span class="line">        <span class="keyword">if</span> isExist &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span>.handle(with: .failure, isSuccess: <span class="literal">false</span>, message: <span class="type">ResponseErrorMessage</span>.userExist.rawValue, value: [])</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建用户</span></span><br><span class="line">        <span class="keyword">let</span> isSuccess = <span class="type">DataBaseManager</span>.shared.store(user: user, to: <span class="type">TableName</span>)</span><br><span class="line">        <span class="keyword">if</span> !isSuccess &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span>.handle(with: .failure, isSuccess: <span class="literal">false</span>, message: <span class="type">ResponseErrorMessage</span>.userCreationFailed.rawValue, value: [])</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 是否创建用户成功</span></span><br><span class="line">        <span class="keyword">let</span> users = <span class="type">DataBaseManager</span>.shared.users(of: userName, <span class="keyword">in</span>: <span class="type">TableName</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.handle(with: .success, isSuccess: <span class="literal">true</span>, message: <span class="literal">nil</span>, value: users)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UserMediator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 服务器响应数据处理</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// - Parameters:</span></span><br><span class="line">    <span class="comment">///   - state: 服务器响应结果（实际处理应该为响应结果状态枚举，本处简单的处理为成功/失败）</span></span><br><span class="line">    <span class="comment">///   - isSuccess: 是否成功的标记</span></span><br><span class="line">    <span class="comment">///   - message: 描述信息</span></span><br><span class="line">    <span class="comment">///   - value: 响应数据</span></span><br><span class="line">    <span class="comment">/// - Returns: 响应数据序列化为json字符串</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(with state: ResponseStatus, isSuccess: Bool, message: String?, value: [[String: Any]]?)</span></span> -&gt; <span class="type">String</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> resultDict: [<span class="type">String</span> : <span class="type">Any</span>] = [</span><br><span class="line">            <span class="string">"status"</span> : state.rawValue,</span><br><span class="line">            <span class="string">"flag"</span> : isSuccess,</span><br><span class="line">            <span class="string">"message"</span> : message ?? <span class="string">""</span>,</span><br><span class="line">            <span class="string">"value"</span> : value ?? []</span><br><span class="line">        ]</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">try</span> resultDict.jsonEncodedString()</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(error)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="MySQL数据库"><a href="#MySQL数据库" class="headerlink" title="MySQL数据库"></a>MySQL数据库</h2><ul>
<li><code>MySQL</code>数据库的安装，请参考之前的文章，本文开头有跳转连接。</li>
</ul>
<h3 id="创建数据库和表"><a href="#创建数据库和表" class="headerlink" title="创建数据库和表"></a>创建数据库和表</h3><ul>
<li>创建并配置<code>MySQL</code>数据库，本文以<code>Navicat Premium</code>为例子。</li>
<li>打开<code>Navicat Premium</code>软件，点击左上角的连接，选择MySQL，在弹出的窗口中输入对应的信息：如我的连接名称为<code>iNote</code>，其他选项如<code>Host</code>、<code>Port</code>、<code>User Name</code>保持默认，密码即为你的安装的MySQL密码。</li>
</ul>
<center><img src="/uploads/assets/MySQL_connect.png" alt="MySQL_connect"></center>

<ul>
<li>配置完服务器信息，就可以创建一个数据库，例如我创建一个名字为<code>iNoteDB</code>的数据库。</li>
<li>在<code>iNoteDB</code>数据库中简单的新建了两张表，一张是用户表<code>T_Users</code>， 一张是笔记表<code>T_Note</code>。表结构如下：</li>
<li>我的字符集选<code>utf-8</code>，排序规则<code>utf8_general_ci</code>。</li>
</ul>
<center><img src="/uploads/assets/mysql_t-user.png" alt="mysql_t-user"></center><br><center><img src="/uploads/assets/mysql_t-note.png" alt="mysql_t-note"></center>

<ul>
<li>我们也可以手动在表中插入数据，如我们在用户表中插入一条数据，用户名<code>西门抽血</code>，密码<code>1234567</code>。</li>
</ul>
<h3 id="数据库管理工具"><a href="#数据库管理工具" class="headerlink" title="数据库管理工具"></a>数据库管理工具</h3><ul>
<li>创建<code>DataBaseManager</code>文件，用户管理数据库的连接、关闭及数据CRUD操作。</li>
<li>数据库的连接配置文件如下：</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MARK: 数据库信息</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MySQLConnector</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> host = <span class="string">"127.0.0.1"</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> account = <span class="string">"root"</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> password = <span class="string">"1234567"</span> <span class="comment">// 之前安装的MySQL服务器的密码</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> database = <span class="string">"iNoteDB"</span> <span class="comment">// 刚刚创建的数据库名称</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>创建数据库管理者</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataBaseManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 单例 全局数据库工具访问点</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> shared = <span class="type">DataBaseManager</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> mysql: <span class="type">MySQL</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">init</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        mysql = <span class="type">MySQL</span>.<span class="keyword">init</span>() <span class="comment">// 创建MySQL对象</span></span><br><span class="line">        <span class="keyword">let</span> connected = mysql.connect(host: <span class="type">MySQLConnector</span>.host, user: <span class="type">MySQLConnector</span>.account, password: <span class="type">MySQLConnector</span>.password, db: <span class="type">MySQLConnector</span>.database)</span><br><span class="line">        <span class="keyword">guard</span> connected <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"MySQL连接失败"</span> + mysql.errorMessage())</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>操作数据库进行常规的CURD</p>
<ul>
<li><code>isExist方法</code> 用于查询特定的用户是否存在</li>
<li><code>store方法</code> 用于缓存一条用户记录到本地</li>
<li><code>users方法</code> 用于查询特定的一条用户数据记录</li>
</ul>
</li>
<li><p><code>Perfect</code>对<code>MySQL</code>的支持还不是很完善，写出来的代码比较丑陋，可以尝试下使用其他的数据或者配套的对象管理函数库（<code>ORM</code>），总的来说支持的<code>服务器种类</code>还是比较完善的，总能找到你中意的一款。</p>
</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MARK: User</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">DataBaseManager</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">isExist</span><span class="params">(of userName: String, <span class="keyword">in</span> tableName: String)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> sql = <span class="string">"SELECT * FROM \(tableName) WHERE userName = '\(userName)'"</span></span><br><span class="line">        <span class="keyword">if</span> !mysql.query(statement: sql) &#123;</span><br><span class="line">            <span class="type">LogFile</span>.error(<span class="string">"Error query : \(sql)"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 在当前会话过程中保存查询结果</span></span><br><span class="line">        <span class="keyword">let</span> resultSets = mysql.storeResults()</span><br><span class="line">        <span class="keyword">var</span> resultArray = [[<span class="type">String</span>: <span class="type">String</span>]]()</span><br><span class="line">        </span><br><span class="line">        resultSets?.forEachRow(callback: &#123; (row) <span class="keyword">in</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> userID = row[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">let</span> userName = row[<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">let</span> password = row[<span class="number">2</span>]</span><br><span class="line">            <span class="keyword">let</span> created = row[<span class="number">3</span>]</span><br><span class="line">            <span class="keyword">let</span> updated = row[<span class="number">4</span>]</span><br><span class="line">            <span class="keyword">var</span> dict = [<span class="type">String</span>: <span class="type">String</span>]()</span><br><span class="line">            dict[<span class="string">"userID"</span>] = userID</span><br><span class="line">            dict[<span class="string">"userName"</span>] = userName</span><br><span class="line">            dict[<span class="string">"password"</span>] = password</span><br><span class="line">            dict[<span class="string">"created"</span>] = created</span><br><span class="line">            dict[<span class="string">"updated"</span>] = updated</span><br><span class="line">            resultArray.append(dict)</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> numRows = mysql.storeResults()?.numRows(), numRows &lt;= <span class="number">0</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">store</span><span class="params">(user: User, to tableName: String)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> userName = user.userName, <span class="keyword">let</span> pwd = user.password <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">false</span> &#125;</span><br><span class="line">        <span class="keyword">let</span> values = <span class="string">"('\(userName)', '\(pwd)')"</span></span><br><span class="line">        <span class="keyword">let</span> sql = <span class="string">"INSERT INTO \(tableName) (userName, password) VALUES \(values))"</span></span><br><span class="line">        <span class="keyword">if</span> !mysql.query(statement: sql) &#123;</span><br><span class="line">            <span class="type">LogFile</span>.error(<span class="string">"Error query : \(sql)"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">users</span><span class="params">(of userName: String, <span class="keyword">in</span> tableName: String)</span></span> -&gt; [[<span class="type">String</span>: <span class="type">Any</span>]]?</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> sql = <span class="string">"SELECT * FROM \(tableName) WHERE userName = '\(userName)'"</span></span><br><span class="line">        <span class="keyword">if</span> !mysql.query(statement: sql) &#123;</span><br><span class="line">            <span class="type">LogFile</span>.error(<span class="string">"Error query : \(sql)"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 在当前会话过程中保存查询结果</span></span><br><span class="line">        <span class="keyword">let</span> resultSets = mysql.storeResults()</span><br><span class="line">        <span class="keyword">var</span> resultArray = [[<span class="type">String</span>: <span class="type">String</span>]]()</span><br><span class="line">        resultSets?.forEachRow(callback: &#123; (row) <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">let</span> userID = row[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">let</span> userName = row[<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">let</span> password = row[<span class="number">2</span>]</span><br><span class="line">            <span class="keyword">let</span> created = row[<span class="number">3</span>]</span><br><span class="line">            <span class="keyword">let</span> updated = row[<span class="number">4</span>]</span><br><span class="line">            <span class="keyword">var</span> dict = [<span class="type">String</span>: <span class="type">String</span>]()</span><br><span class="line">            dict[<span class="string">"userID"</span>] = userID</span><br><span class="line">            dict[<span class="string">"userName"</span>] = userName</span><br><span class="line">            dict[<span class="string">"password"</span>] = password</span><br><span class="line">            dict[<span class="string">"created"</span>] = created</span><br><span class="line">            dict[<span class="string">"updated"</span>] = updated</span><br><span class="line">            resultArray.append(dict)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> resultArray</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="启动及测试服务器"><a href="#启动及测试服务器" class="headerlink" title="启动及测试服务器"></a>启动及测试服务器</h2><ul>
<li>在程序入口<code>Main.swift</code>文件配置启动服务器，因为上面我们已经在服务器管理者这个文件中封装好了启动方法，此时就可以一行搞定：</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 启动服务器</span></span><br><span class="line"><span class="type">NetworkServerManager</span>.shared.serverStart()</span><br></pre></td></tr></table></figure>
<ul>
<li>运行项目，等待控制台输出如下信息代表启动服务器成功，然后测试注册服务器接口了，以<code>post请求的注册接口</code>为例子：<ul>
<li>我们这里使用<code>Paw</code>工具测试网络接口，当然你们也可以使用<code>Post Man</code>测试，甚至你想的话可以自己写网络接口调用测试。</li>
<li>如果是get请求，你可以直接在浏览器就可以测试，如果你想改下本例子的请求方式，只需要在路由配置方法中把<code>.get</code>改为<code>.post</code>即可。</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[INFO] Starting HTTP server  on 0.0.0.0:8181</span><br></pre></td></tr></table></figure>
<ul>
<li>例如我们测试，用户名<code>西门抽血</code>，密码<code>1234567</code>进行注册，因为之前我们在数据库中手动添加了一条相同记录，所以注册结果如下图：接口调用成功，服务器返回注册失败信息。<center><img src="/uploads/assets/server_register_test.png" alt="server_register_test"></center>

</li>
</ul>
<h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><ul>
<li>本文只是对使用Perfect搭建服务器的一个概要性总结，希望大家通过本文可以对Swift开发服务器整个流程有一个认识，具体的细节和注意点都待完善。</li>
<li>至于项目Demo，肯定是有的，但是目前是不可能给到大家了，因为我还没有写完啊，目前只是写了一个粗略的注册接口，并且逻辑还没写完😂。</li>
<li>其实项目的完善部分就集中在接口响应处理的对服务器CRUD部分了，因为使用Mysql服务器用的很不顺手，可能会换用其他比较完善的数据库再完善这一部分。</li>
<li>等服务端写完，在开坑对应的客户端，客户端就不用说了，大家估计都快写吐了😂。至于什么时候能写完，我自己都不知道，毕竟我这么懒🌚🌝！</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.perfect.org/zh/assistant/" target="_blank" rel="noopener">官方文档</a><br><a href="https://www.perfect.org/docs/index_zh_CN.html" target="_blank" rel="noopener">Perfect官方文档在这里</a><br><a href="https://swift.org/download/#using-downloads" target="_blank" rel="noopener">Swift官方文档</a><br><a href="https://swift.org/package-manager/#conceptual-overview" target="_blank" rel="noopener">Swift包管理器</a>.<br><a href="https://juejin.im/post/59826a4e518825359c5e72d1" target="_blank" rel="noopener">服务端指南 | 良好的 API 设计指南</a><br><a href="https://www.jianshu.com/p/2ce98b556e89" target="_blank" rel="noopener">服务端写Swift体验 (Perfect框架)</a><br><a href="http://www.cnblogs.com/ludashi/p/6145344.html" target="_blank" rel="noopener">Swift3.0服务端开发(一) 完整示例概述及Perfect环境搭建与配置（服务端+iOS端）</a></p>

      
    </div>

    

    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>要不要鼓励一下😘</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/uploads/images/wechat-reward-image.JPG" alt="曹雪松 微信"/>
        <p>微信</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/uploads/images/alipay-reward-image.JPG" alt="曹雪松 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>曹雪松</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://sevencho.github.io/archives/f7d447dc.html" title="Swift开发服务端（三）：Perfect再次初体验">https://sevencho.github.io/archives/f7d447dc.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 CC BY-NC-SA 3.0 许可协议。转载请注明出处！</li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Swift/" rel="tag"><i class="fa fa-tag"></i> Swift</a>
          
            <a href="/tags/服务器/" rel="tag"><i class="fa fa-tag"></i> 服务器</a>
          
            <a href="/tags/Perfect/" rel="tag"><i class="fa fa-tag"></i> Perfect</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/archives/64bb63f1.html" rel="next" title="Swift开发服务端（二）：使用Parallels Desktop虚拟机安装Ubuntu系统及相关配置">
                <i class="fa fa-chevron-left"></i> Swift开发服务端（二）：使用Parallels Desktop虚拟机安装Ubuntu系统及相关配置
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/archives/c12f47b1.html" rel="prev" title="iOS攻防（六）：使用Cycript一窥运行程序的神秘面纱(入门篇)">
                iOS攻防（六）：使用Cycript一窥运行程序的神秘面纱(入门篇) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/uploads/images/avatar.JPG"
                alt="曹雪松" />
            
              <p class="site-author-name" itemprop="name">曹雪松</p>
              <p class="site-description motion-element" itemprop="description">一只特立独行的CoderBoy🐶</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">67</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">14</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">58</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/SevenCho" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:243166621@qq.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#正文"><span class="nav-number">2.</span> <span class="nav-text">正文</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ubuntu安装Swift"><span class="nav-number">3.</span> <span class="nav-text">Ubuntu安装Swift</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装Git"><span class="nav-number">3.1.</span> <span class="nav-text">安装Git</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装Swift依赖组件"><span class="nav-number">3.2.</span> <span class="nav-text">安装Swift依赖组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装Swift"><span class="nav-number">3.3.</span> <span class="nav-text">安装Swift</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Perfect服务端"><span class="nav-number">4.</span> <span class="nav-text">Perfect服务端</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用工具新建Perfect项目"><span class="nav-number">4.1.</span> <span class="nav-text">使用工具新建Perfect项目</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Perfect-Assistant-功能"><span class="nav-number">4.1.1.</span> <span class="nav-text">Perfect Assistant 功能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#下载Perfect-Assistant"><span class="nav-number">4.1.2.</span> <span class="nav-text">下载Perfect Assistant</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用Perfect-Assistant创建项目"><span class="nav-number">4.1.3.</span> <span class="nav-text">使用Perfect Assistant创建项目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置处理项目依赖"><span class="nav-number">4.1.4.</span> <span class="nav-text">配置处理项目依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#编译运行项目"><span class="nav-number">4.1.5.</span> <span class="nav-text">编译运行项目</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用终端新建Perfect项目"><span class="nav-number">4.2.</span> <span class="nav-text">使用终端新建Perfect项目</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#使用终端新建项目"><span class="nav-number">4.2.1.</span> <span class="nav-text">使用终端新建项目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置处理项目依赖-1"><span class="nav-number">4.2.2.</span> <span class="nav-text">配置处理项目依赖</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#搭建HTTP服务器"><span class="nav-number">5.</span> <span class="nav-text">搭建HTTP服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL数据库"><span class="nav-number">6.</span> <span class="nav-text">MySQL数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建数据库和表"><span class="nav-number">6.1.</span> <span class="nav-text">创建数据库和表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据库管理工具"><span class="nav-number">6.2.</span> <span class="nav-text">数据库管理工具</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#启动及测试服务器"><span class="nav-number">7.</span> <span class="nav-text">启动及测试服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#结尾"><span class="nav-number">8.</span> <span class="nav-text">结尾</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-number">9.</span> <span class="nav-text">参考</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">曹雪松</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">351k</span>
  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Muse</a></div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  















  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.4.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.1"></script>



  



  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
  

  

  

  

  

  

<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"superSample":2,"width":120,"height":200,"position":"left","hOffset":20,"vOffset":50},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/"});</script></body>
</html>
